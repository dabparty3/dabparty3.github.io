<!DOCTYPE html>
<html>
<head>
  <title>The Lobby</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #00ff00;
      font-family: monospace;
      padding: 10px;
      height: 100vh;
      overflow: hidden;
    }

    #terminal-wrapper {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #terminal {
      flex-grow: 1;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .input-line {
      display: inline;
    }

    .prompt {
      color: #0f0;
    }

    .command {
      color: #fff;
    }

    .output {
      color: #0f0;
    }

    .cursor {
      display: inline-block;
      width: 10px;
      animation: blink 1s step-start 0s infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    ::selection {
      background: #00ff00;
      color: black;
    }
  </style>
</head>
<body>
  <div id="terminal-wrapper">
    <div id="terminal" tabindex="0"></div>
  </div>

  <script>
    const terminal = document.getElementById('terminal');
    const PROMPT = "guest@thelobby:~$ ";
    let history = [];
    let historyIndex = -1;
    let input = "";

    const commands = {
      help: () => "Available commands:\nhelp - Show this help\nclear - Clear the terminal\necho [text] - Repeat text\nabout - Info about this page",
      clear: () => {
        terminal.innerHTML = "";
        return "";
      },
      echo: (args) => args.join(" "),
      about: () => "blank until i can think of ideas"
    };

    function renderLine(text, className = "output") {
      const line = document.createElement('div');
      line.className = className;
      line.textContent = text;
      terminal.appendChild(line);
    }

    function renderPrompt() {
      const promptLine = document.createElement('div');
      promptLine.className = "input-line";
      promptLine.innerHTML = `<span class="prompt">${PROMPT}</span><span class="command" id="input"></span><span class="cursor">â–ˆ</span>`;
      terminal.appendChild(promptLine);
    }

    function processCommand(cmd) {
      if (!cmd.trim()) return;
      const args = cmd.split(" ");
      const base = args.shift().toLowerCase();
      const action = commands[base];
      if (action) {
        const result = action(args);
        if (result) renderLine(result);
      } else {
        renderLine(`Command not found: ${base}`);
      }
    }

    function commitInput() {
      const inputLine = document.getElementById("input").textContent;
      const fullLine = PROMPT + inputLine;

      // Remove the current input line
      const last = terminal.lastElementChild;
      if (last) terminal.removeChild(last);

      renderLine(fullLine);
      history.push(inputLine);
      historyIndex = history.length;
      processCommand(inputLine);
      input = "";
      renderPrompt();
      scrollToBottom();
    }

    function updateInput() {
      const inputEl = document.getElementById("input");
      if (inputEl) inputEl.textContent = input;
    }

    function scrollToBottom() {
      terminal.scrollTop = terminal.scrollHeight;
    }

    terminal.addEventListener('keydown', (e) => {
      e.preventDefault();
      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
        input += e.key;
      } else if (e.key === "Backspace") {
        input = input.slice(0, -1);
      } else if (e.key === "Enter") {
        commitInput();
      } else if (e.key === "ArrowUp") {
        if (historyIndex > 0) {
          historyIndex--;
          input = history[historyIndex];
        }
      } else if (e.key === "ArrowDown") {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          input = history[historyIndex];
        } else {
          input = "";
          historyIndex = history.length;
        }
      }
      updateInput();
      scrollToBottom();
    });

    // Ensure terminal is always focused
    setInterval(() => terminal.focus(), 500);

    // Init
    renderPrompt();
    terminal.focus();
    scrollToBottom();
  </script>
</body>
</html>
