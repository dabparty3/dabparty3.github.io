<!DOCTYPE html>
<html>
<head>
  <title>The Terminal</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: #000;
      color: #00ff00;
      font-family: monospace;
      overflow: hidden;
    }

    #terminal-wrapper {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #terminal {
      flex-grow: 1;
      overflow-y: auto;
      white-space: pre-wrap;
      padding: 10px;
      outline: none;
    }

    .prompt {
      color: #0f0;
    }

    .command {
      color: #fff;
    }

    .output {
      color: #0f0;
    }

    .cursor {
      display: inline-block;
      width: 10px;
      animation: blink 1s step-start infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    ::selection {
      background: #00ff00;
      color: black;
    }

    /* Close button style for overlay */
    #example-overlay-close {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10000;
      background: #222;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px 10px;
      cursor: pointer;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="terminal-wrapper">
    <div id="terminal" tabindex="0"></div>
  </div>

  <script>
    const terminal = document.getElementById('terminal');
    const PROMPT = "guest@thelobby:~$ ";
    let history = [];
    let historyIndex = -1;
    let input = "";

    const commands = {
      help: () => `Available commands:
help        - Show this list
clear       - Clear the terminal
echo [text] - Repeat text
about       - Info about this page
fullscreen  - Make the page fullscreen
example     - Redirect to example.html
example1    - Show example overlay`,

      clear: () => {
        terminal.innerHTML = "";
        return "";
      },

      echo: (args) => args.join(" "),

      about: () => "Hey there. This is something I made to house my projects... It's pretty cool, right?",

      fullscreen: () => {
        const el = document.documentElement;
        if (el.requestFullscreen) {
          el.requestFullscreen();
          return "Entering fullscreen...";
        }
        return "Fullscreen not supported.";
      },

      example: () => {
        renderLine("Opening example.html...");
        setTimeout(() => window.location.href = "example.html", 500);
        return "";
      },

      example1: () => {
        renderLine("Loading example overlay...");
        setTimeout(showExampleOverlay, 500);
        return "";
      }
    };

    function renderLine(text, className = "output") {
      const line = document.createElement('div');
      line.className = className;
      line.textContent = text;
      terminal.appendChild(line);
    }

    function renderPrompt() {
      const line = document.createElement('div');
      line.innerHTML = `<span class="prompt">${PROMPT}</span><span class="command" id="input"></span><span class="cursor">â–ˆ</span>`;
      terminal.appendChild(line);
      scrollToBottom();
    }

    function processCommand(cmd) {
      const args = cmd.trim().split(" ");
      const base = args.shift().toLowerCase();
      const action = commands[base];
      const result = action ? action(args) : `Command not found: ${base}`;
      if (result) renderLine(result);
    }

    function commitInput() {
      const inputText = input;
      const full = `${PROMPT}${inputText}`;

      terminal.lastElementChild?.remove(); // remove current input line
      renderLine(full);
      history.push(inputText);
      historyIndex = history.length;
      processCommand(inputText);

      input = "";
      renderPrompt();
    }

    function updateInput() {
      const inputEl = document.getElementById("input");
      if (inputEl) inputEl.textContent = input;
    }

    function scrollToBottom() {
      terminal.scrollTop = terminal.scrollHeight;
    }

    function bootScreen() {
      renderLine("Car Door Terminal [Version 10.0.19045.5965]");
      renderLine("(c) CarDoor Corporations. All rights reserved.");
      renderLine("Use 'help' for a list of commands.\n");
    }

    // Show the example page as an overlay on top of the terminal
    function showExampleOverlay() {
      // Check if overlay already exists
      if(document.getElementById('example-overlay')) return;

      const overlay = document.createElement('div');
      overlay.id = 'example-overlay';
      overlay.style = `
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: #000;
        z-index: 9999;
        overflow: auto;
        color: #0f0;
        font-family: monospace;
        padding: 20px;
      `;

      const closeBtn = document.createElement('button');
      closeBtn.id = 'example-overlay-close';
      closeBtn.textContent = "Close Overlay";
      closeBtn.onclick = () => overlay.remove();

      overlay.appendChild(closeBtn);

      // Fetch the external page content
      fetch('https://dabparty3.github.io/example')
        .then(response => {
          if (!response.ok) throw new Error('Failed to load example page');
          return response.text();
        })
        .then(html => {
          const contentDiv = document.createElement('div');
          contentDiv.innerHTML = html;

          // Optionally sanitize or remove scripts here if you want

          overlay.appendChild(contentDiv);
        })
        .catch(err => {
          overlay.textContent = "Error loading example page: " + err.message;
        });

      document.body.appendChild(overlay);
    }

    terminal.addEventListener('keydown', (e) => {
      e.preventDefault();

      if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
        input += e.key;
      } else if (e.key === "Backspace") {
        input = input.slice(0, -1);
      } else if (e.key === "Enter") {
        commitInput();
      } else if (e.key === "ArrowUp") {
        if (historyIndex > 0) {
          historyIndex--;
          input = history[historyIndex];
        }
      } else if (e.key === "ArrowDown") {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          input = history[historyIndex];
        } else {
          input = "";
          historyIndex = history.length;
        }
      }

      updateInput();
      scrollToBottom();
    });

    // Init
    bootScreen();
    renderPrompt();
    terminal.focus();
    setInterval(() => terminal.focus(), 500);
  </script>
</body>
</html>
